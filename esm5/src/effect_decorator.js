import { compose } from '@ngrx/store';
import { getSourceForInstance } from './utils';
var METADATA_KEY = '__@ngrx/effects__';
export function Effect(_a) {
    var _b = _a === void 0 ? {} : _a, _c = _b.dispatch, dispatch = _c === void 0 ? true : _c, _d = _b.resubscribeOnError, resubscribeOnError = _d === void 0 ? true : _d;
    return function (target, propertyName) {
        // Right now both createEffect and @Effect decorator set default values.
        // Ideally that should only be done in one place that aggregates that info,
        // for example in mergeEffects().
        var metadata = {
            propertyName: propertyName,
            dispatch: dispatch,
            resubscribeOnError: resubscribeOnError,
        };
        setEffectMetadataEntries(target, [metadata]);
    };
}
export function getEffectDecoratorMetadata(instance) {
    var effectsDecorators = compose(getEffectMetadataEntries, getSourceForInstance)(instance);
    return effectsDecorators;
}
function setEffectMetadataEntries(sourceProto, entries) {
    var constructor = sourceProto.constructor;
    var meta = constructor.hasOwnProperty(METADATA_KEY)
        ? constructor[METADATA_KEY]
        : Object.defineProperty(constructor, METADATA_KEY, { value: [] })[METADATA_KEY];
    Array.prototype.push.apply(meta, entries);
}
function getEffectMetadataEntries(sourceProto) {
    return sourceProto.constructor.hasOwnProperty(METADATA_KEY)
        ? sourceProto.constructor[METADATA_KEY]
        : [];
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWZmZWN0X2RlY29yYXRvci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL21vZHVsZXMvZWZmZWN0cy9zcmMvZWZmZWN0X2RlY29yYXRvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBR3RDLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUUvQyxJQUFNLFlBQVksR0FBRyxtQkFBbUIsQ0FBQztBQUV6QyxNQUFNLFVBQVUsTUFBTSxDQUFDLEVBR0g7UUFIRyw0QkFHSCxFQUZsQixnQkFBZSxFQUFmLG9DQUFlLEVBQ2YsMEJBQXlCLEVBQXpCLDhDQUF5QjtJQUV6QixPQUFPLFVBQ0wsTUFBUyxFQUNULFlBQWU7UUFFZix3RUFBd0U7UUFDeEUsMkVBQTJFO1FBQzNFLGlDQUFpQztRQUNqQyxJQUFNLFFBQVEsR0FBc0I7WUFDbEMsWUFBWSxjQUFBO1lBQ1osUUFBUSxVQUFBO1lBQ1Isa0JBQWtCLG9CQUFBO1NBQ25CLENBQUM7UUFDRix3QkFBd0IsQ0FBSSxNQUFNLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO0lBQ2xELENBQUMsQ0FBQztBQUNKLENBQUM7QUFFRCxNQUFNLFVBQVUsMEJBQTBCLENBQ3hDLFFBQVc7SUFFWCxJQUFNLGlCQUFpQixHQUF3QixPQUFPLENBQ3BELHdCQUF3QixFQUN4QixvQkFBb0IsQ0FDckIsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUVaLE9BQU8saUJBQWlCLENBQUM7QUFDM0IsQ0FBQztBQUVELFNBQVMsd0JBQXdCLENBQy9CLFdBQWMsRUFDZCxPQUE0QjtJQUU1QixJQUFNLFdBQVcsR0FBRyxXQUFXLENBQUMsV0FBVyxDQUFDO0lBQzVDLElBQU0sSUFBSSxHQUE2QixXQUFXLENBQUMsY0FBYyxDQUMvRCxZQUFZLENBQ2I7UUFDQyxDQUFDLENBQUUsV0FBbUIsQ0FBQyxZQUFZLENBQUM7UUFDcEMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUMsV0FBVyxFQUFFLFlBQVksRUFBRSxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUM3RCxZQUFZLENBQ2IsQ0FBQztJQUNOLEtBQUssQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUM7QUFDNUMsQ0FBQztBQUVELFNBQVMsd0JBQXdCLENBQy9CLFdBQWM7SUFFZCxPQUFPLFdBQVcsQ0FBQyxXQUFXLENBQUMsY0FBYyxDQUFDLFlBQVksQ0FBQztRQUN6RCxDQUFDLENBQUUsV0FBVyxDQUFDLFdBRVgsQ0FBQyxZQUFZLENBQUM7UUFDbEIsQ0FBQyxDQUFDLEVBQUUsQ0FBQztBQUNULENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjb21wb3NlIH0gZnJvbSAnQG5ncngvc3RvcmUnO1xuXG5pbXBvcnQgeyBFZmZlY3RDb25maWcsIEVmZmVjdE1ldGFkYXRhLCBFZmZlY3RQcm9wZXJ0eUtleSB9IGZyb20gJy4vbW9kZWxzJztcbmltcG9ydCB7IGdldFNvdXJjZUZvckluc3RhbmNlIH0gZnJvbSAnLi91dGlscyc7XG5cbmNvbnN0IE1FVEFEQVRBX0tFWSA9ICdfX0BuZ3J4L2VmZmVjdHNfXyc7XG5cbmV4cG9ydCBmdW5jdGlvbiBFZmZlY3Qoe1xuICBkaXNwYXRjaCA9IHRydWUsXG4gIHJlc3Vic2NyaWJlT25FcnJvciA9IHRydWUsXG59OiBFZmZlY3RDb25maWcgPSB7fSkge1xuICByZXR1cm4gZnVuY3Rpb248VCBleHRlbmRzIE9iamVjdCwgSyBleHRlbmRzIEVmZmVjdFByb3BlcnR5S2V5PFQ+PihcbiAgICB0YXJnZXQ6IFQsXG4gICAgcHJvcGVydHlOYW1lOiBLXG4gICkge1xuICAgIC8vIFJpZ2h0IG5vdyBib3RoIGNyZWF0ZUVmZmVjdCBhbmQgQEVmZmVjdCBkZWNvcmF0b3Igc2V0IGRlZmF1bHQgdmFsdWVzLlxuICAgIC8vIElkZWFsbHkgdGhhdCBzaG91bGQgb25seSBiZSBkb25lIGluIG9uZSBwbGFjZSB0aGF0IGFnZ3JlZ2F0ZXMgdGhhdCBpbmZvLFxuICAgIC8vIGZvciBleGFtcGxlIGluIG1lcmdlRWZmZWN0cygpLlxuICAgIGNvbnN0IG1ldGFkYXRhOiBFZmZlY3RNZXRhZGF0YTxUPiA9IHtcbiAgICAgIHByb3BlcnR5TmFtZSxcbiAgICAgIGRpc3BhdGNoLFxuICAgICAgcmVzdWJzY3JpYmVPbkVycm9yLFxuICAgIH07XG4gICAgc2V0RWZmZWN0TWV0YWRhdGFFbnRyaWVzPFQ+KHRhcmdldCwgW21ldGFkYXRhXSk7XG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRFZmZlY3REZWNvcmF0b3JNZXRhZGF0YTxUPihcbiAgaW5zdGFuY2U6IFRcbik6IEVmZmVjdE1ldGFkYXRhPFQ+W10ge1xuICBjb25zdCBlZmZlY3RzRGVjb3JhdG9yczogRWZmZWN0TWV0YWRhdGE8VD5bXSA9IGNvbXBvc2UoXG4gICAgZ2V0RWZmZWN0TWV0YWRhdGFFbnRyaWVzLFxuICAgIGdldFNvdXJjZUZvckluc3RhbmNlXG4gICkoaW5zdGFuY2UpO1xuXG4gIHJldHVybiBlZmZlY3RzRGVjb3JhdG9ycztcbn1cblxuZnVuY3Rpb24gc2V0RWZmZWN0TWV0YWRhdGFFbnRyaWVzPFQgZXh0ZW5kcyBvYmplY3Q+KFxuICBzb3VyY2VQcm90bzogVCxcbiAgZW50cmllczogRWZmZWN0TWV0YWRhdGE8VD5bXVxuKSB7XG4gIGNvbnN0IGNvbnN0cnVjdG9yID0gc291cmNlUHJvdG8uY29uc3RydWN0b3I7XG4gIGNvbnN0IG1ldGE6IEFycmF5PEVmZmVjdE1ldGFkYXRhPFQ+PiA9IGNvbnN0cnVjdG9yLmhhc093blByb3BlcnR5KFxuICAgIE1FVEFEQVRBX0tFWVxuICApXG4gICAgPyAoY29uc3RydWN0b3IgYXMgYW55KVtNRVRBREFUQV9LRVldXG4gICAgOiBPYmplY3QuZGVmaW5lUHJvcGVydHkoY29uc3RydWN0b3IsIE1FVEFEQVRBX0tFWSwgeyB2YWx1ZTogW10gfSlbXG4gICAgICAgIE1FVEFEQVRBX0tFWVxuICAgICAgXTtcbiAgQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkobWV0YSwgZW50cmllcyk7XG59XG5cbmZ1bmN0aW9uIGdldEVmZmVjdE1ldGFkYXRhRW50cmllczxUIGV4dGVuZHMgb2JqZWN0PihcbiAgc291cmNlUHJvdG86IFRcbik6IEVmZmVjdE1ldGFkYXRhPFQ+W10ge1xuICByZXR1cm4gc291cmNlUHJvdG8uY29uc3RydWN0b3IuaGFzT3duUHJvcGVydHkoTUVUQURBVEFfS0VZKVxuICAgID8gKHNvdXJjZVByb3RvLmNvbnN0cnVjdG9yIGFzIHR5cGVvZiBzb3VyY2VQcm90by5jb25zdHJ1Y3RvciAmIHtcbiAgICAgICAgW01FVEFEQVRBX0tFWV06IEVmZmVjdE1ldGFkYXRhPFQ+W107XG4gICAgICB9KVtNRVRBREFUQV9LRVldXG4gICAgOiBbXTtcbn1cbiJdfQ==